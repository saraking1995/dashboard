<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Tra c·ª©u ph√¢n c√¥ng</title>
<style>
  :root{
    --bg: #f1f5f9;
    --card: #ffffff;
    --text: #0f172a;
    --muted: #64748b;
    --primary: #2563eb;
    --accent: #0ea5e9;
    --danger: #ef4444;
    --pill-bg: #f8fafc;
    --shadow-sm: 0 1px 2px rgba(0,0,0,0.04);
    --shadow: 0 1px 3px rgba(0,0,0,0.1);
    --shadow-md: 0 4px 6px -1px rgba(0,0,0,0.1);
    --shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.1);
    --ring: 0 0 0 3px rgba(59,130,246,0.45);
  }
  [data-theme="dark"]{
    --bg: #0f172a;
    --card: #1e293b;
    --text: #f1f5f9;
    --muted: #94a3b8;
    --primary: #3b82f6;
    --accent: #0ea5e9;
    --danger: #f87171;
    --pill-bg: #1e293b;
    --shadow-sm: 0 1px 2px rgba(0,0,0,0.3);
    --shadow: 0 1px 3px rgba(0,0,0,0.3);
    --shadow-md: 0 4px 6px -1px rgba(0,0,0,0.3);
    --shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.3);
    --ring: 0 0 0 3px rgba(59,130,246,0.3);
  }
  [data-theme="dark"] #card b,
  [data-theme="dark"] #card b {
  color: #000 !important;
}
  [data-theme="dark"] #card div,
  [data-theme="dark"] #card span {
    color: var(--text);
  }
  body { 
    font-family: system-ui, -apple-system, sans-serif; 
    background:var(--bg); 
    padding:24px; 
    color:var(--text);
    line-height: 1.5;
    transition: background .3s ease;
  }
  h1 { 
    color:var(--text); 
    text-align:center; 
    margin-bottom:16px;
    font-size: 24px;
    font-weight: 700;
    letter-spacing: -0.025em;
  }
  input, button { 
    font-size:15px; 
    padding:8px 12px;
    font-family: inherit;
  }
  button { 
    cursor:pointer; 
    border:none; 
    border-radius:8px; 
    background:var(--primary); 
    color:#fff;
    font-weight: 500;
    transition: all .2s ease;
  }
  button:hover { 
    background:var(--accent);
    transform: translateY(-1px);
    box-shadow: var(--shadow-md);
  }
  #card { 
    margin-top:24px; 
    background:var(--card); 
    border-radius:16px; 
    padding:24px;
    box-shadow: var(--shadow-lg);
    border: 1px solid rgba(148,163,184,0.1);
    transition: transform .3s ease, box-shadow .3s ease;
  }
  #card:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg), 0 20px 25px -5px rgba(0,0,0,0.1);
  }
  #noiDung { margin-top:6px; white-space:pre-wrap; background:var(--card); border:1px solid rgba(99,102,241,0.04); border-radius:8px; padding:10px; transition: box-shadow .18s ease, transform .12s ease, opacity .12s ease; }
  #names { margin-top:12px; display:flex; flex-wrap:wrap; gap:8px; }
  label { background:var(--pill-bg); padding:6px 10px; border-radius:999px; display:inline-flex; align-items:center; gap:8px; border:1px solid rgba(99,102,241,0.03); }
  label.red { color:var(--danger); font-weight:700; background: linear-gradient(90deg, rgba(254,226,226,0.06), rgba(254,226,226,0.02)); }
  /* checkbox toggle animation */
  label .cb { width:14px; height:14px; display:inline-block; margin-right:6px; vertical-align:middle; }
  label .badge-anim { display:inline-block; transition: transform .12s ease; }
  #note { color:var(--muted); font-size:13px; margin-top:8px;}
  #log { text-align:center; font-size:13px; color:var(--muted); margin-top:12px;}
  /* local highlight style for immediate visual feedback */
  .highlight { background:#fee2e2; color:#991b1b; font-weight:700; padding:0 4px; border-radius:4px; transition: background-color .18s ease, color .18s ease; font-family: 'Times New Roman', Times, serif; font-size: 12px; }
  /* small spinner in the #log area */
  .spinner { display:inline-block; width:16px; height:16px; vertical-align:text-bottom; border:2px solid rgba(0,0,0,0.12); border-top-color: rgba(0,0,0,0.5); border-radius:50%; animation:spin .8s linear infinite; margin-right:8px; }
  @keyframes spin { to { transform: rotate(360deg); } }
  /* instruction styling */
  .instruction { text-align:center; margin-top:12px; color:#0f172a; font-size:15px; background:linear-gradient(90deg, rgba(59,130,246,0.06), rgba(16,185,129,0.03)); border:1px solid rgba(96,165,250,0.18); padding:10px 14px; border-radius:8px; display:inline-flex; gap:8px; align-items:center; transition: transform .12s ease, box-shadow .12s ease, opacity .12s ease; }
  .instruction:hover { transform: translateY(-4px); box-shadow: 0 6px 18px rgba(2,6,23,0.08); }
  .instruction .icon { font-size:18px; display:inline-block; color:var(--accent); }
  .instruction .icon svg { width:18px; height:18px; display:block; fill:currentColor; }
  .instruction .text { color:var(--text); font-weight:600; }
  .instruction-close { margin-left:8px; background:transparent; border:none; color:#475569; font-size:14px; cursor:pointer; padding:6px; border-radius:6px; }
  .instruction-close:hover { background: rgba(15,23,42,0.04); }
  .instruction.closing { opacity:0; transform: translateY(6px); }
  @media (max-width:480px) { .instruction { font-size:13px; padding:8px 10px; } }
  /* layout container */
  body {
    min-height: 100vh;
    display: flex;
    flex-direction: column;
  }
  .container { 
    max-width:920px; 
    margin:0 auto; 
    padding:20px;
    width: 100%;
    flex: 1;
    display: flex;
    flex-direction: column;
  }
  /* switch */
  .switch { 
    display:inline-block; 
    position:relative; 
    width:24px; 
    height:10px;
    margin: 0 8px;
  }
  .switch input{ 
    display:none; 
  }
  .switch .slider{ 
    position:absolute; 
    inset:0; 
    background:var(--bg);
    border-radius:999px; 
    border:2px solid rgba(148,163,184,0.2);
    transition: all .3s ease;
    box-shadow: var(--shadow-sm);
  }
  .switch .slider:before{ 
    content:''; 
    position:absolute; 
    width:18px; 
    height:18px; 
    left:2px; 
    top:1px; 
    background:var(--muted); 
    border-radius:50%; 
    transition: all .3s cubic-bezier(.4,0,.2,1);
    box-shadow: var(--shadow);
  } 
  .switch input:checked + .slider{ 
    background: linear-gradient(135deg,var(--primary), var(--accent)); 
    border-color: transparent;
  }
  .switch input:checked + .slider:before{ 
    transform: translateX(20px);
    background: #fff;
    box-shadow: var(--shadow-md);
  }
  .switch:hover .slider:before {
    box-shadow: var(--shadow-lg);
  }
  
  /* Instruction box */
  .instruction { 
    text-align:center; 
    margin-top:24px;
    margin-bottom: 12px;
    color:var(--text); 
    font-size:15px; 
    background:var(--card);
    border:2px solid rgba(148,163,184,0.15); 
    padding:16px 24px; 
    border-radius:16px; 
    display:inline-flex; 
    gap:12px; 
    align-items:center;
    box-shadow: var(--shadow-md);
    transition: all .3s ease;
  }
  .instruction:hover { 
    transform: translateY(-2px); 
    box-shadow: var(--shadow-lg);
  }
  .instruction .icon { 
    font-size:20px; 
    display:inline-block; 
    color:var(--accent);
    opacity: 0.9;
  }
  .instruction .icon svg { 
    width:20px; 
    height:20px; 
    display:block; 
    fill:currentColor;
  }
  .instruction .text { 
    color:var(--text); 
    font-weight:500;
    letter-spacing: 0.01em;
  }
  .instruction-close { 
    margin-left:8px; 
    background:transparent; 
    border:none; 
    color:var(--muted);
    font-size:14px; 
    cursor:pointer; 
    padding:8px; 
    border-radius:8px;
    opacity: 0.7;
    transition: all .2s ease;
  }
  .instruction-close:hover { 
    background: rgba(148,163,184,0.1);
    opacity: 1;
  }
  .instruction.closing { 
    opacity:0; 
    transform: translateY(6px);
  }

  /* buttons and input */
  .btn { 
    font-size:15px; 
    padding:10px 16px; 
    border-radius:10px; 
    border:1px solid transparent; 
    cursor:pointer; 
    transition: all .2s ease;
    font-weight: 500;
    letter-spacing: 0.01em;
  }
  .btn:active { 
    transform: translateY(1px);
  }
  .btn-primary { 
    background:var(--primary); 
    color:#fff; 
    box-shadow: var(--shadow-md);
    background-image: linear-gradient(to right, var(--primary), var(--accent));
  }
  .btn-primary:hover { 
    box-shadow: var(--shadow-lg);
    transform: translateY(-1px);
    filter: brightness(110%);
  }
  .btn-ghost { 
    background:transparent; 
    color:var(--text); 
    border-color:rgba(148,163,184,0.2);
    box-shadow: var(--shadow-sm);
  }
  .btn-ghost:hover { 
    background: rgba(148,163,184,0.1);
    border-color:rgba(148,163,184,0.3);
  }
  .btn-search { 
    background: linear-gradient(135deg, var(--accent), var(--primary)); 
    color:#fff; 
    border-radius:12px; 
    padding:10px 20px;
    font-weight: 600;
    box-shadow: var(--shadow-md);
  }
  .btn-search:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
    filter: brightness(110%);
  }

  .input { 
    padding:12px 16px; 
    border-radius:12px; 
    border:2px solid rgba(148,163,184,0.2); 
    width:240px; 
    background: var(--card);
    color: var(--text);
    transition: all .2s ease;
    font-size: 15px;
  }
  .input:focus { 
    outline:none; 
    border-color:var(--primary);
    box-shadow: var(--ring);
    transform: translateY(-1px);
  }
  .input::placeholder {
    color: var(--muted);
  }

  /* User info */
  .user-info {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-top: 12px;
    padding: 8px 16px;
    background: var(--card);
    border-radius: 12px;
    border: 2px solid rgba(148,163,184,0.1);
    font-size: 14px;
  }

  .btn-sm {
    font-size: 13px;
    padding: 6px 12px;
  }

  /* label pills */
  #names label { 
    background:var(--pill-bg); 
    padding:8px 14px; 
    border-radius:12px; 
    border:2px solid rgba(148,163,184,0.15); 
    display:inline-flex; 
    align-items:center; 
    gap:10px;
    transition: all .2s ease;
    font-weight: 500;
    box-shadow: var(--shadow-sm);
  }
  #names label:hover {
    transform: translateY(-1px);
    box-shadow: var(--shadow-md);
    border-color: rgba(148,163,184,0.25);
  }
  #names label.red { 
    background:linear-gradient(135deg, var(--danger), color-mix(in srgb, var(--danger) 85%, white)); 
    border-color:transparent; 
    color:#fff; 
    font-weight:600;
    box-shadow: var(--shadow-md);
  }
  #names label.red:hover {
    filter: brightness(110%);
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
  }

  /* focus-visible for accessibility */
  .btn:focus, .input:focus, #names input:focus + span { 
    outline: none;
    box-shadow: var(--ring);
  }

  /* mobile tweaks */
  @media (max-width:640px){
    .container{ padding:16px; }
    .input{ width:160px; }
    .container h1{ font-size:20px; }
    #names{ gap:8px; }
  }
  
  /* sr-only helper */
  .sr-only{ 
    position:absolute !important; 
    height:1px; 
    width:1px; 
    overflow:hidden; 
    clip:rect(1px,1px,1px,1px); 
    white-space:nowrap; 
  }

  /* Loading states */
  .spinner-border {
    display: inline-block;
    width: 1rem;
    height: 1rem;
    vertical-align: -0.125em;
    border: 0.2em solid currentColor;
    border-right-color: transparent;
    border-radius: 50%;
    animation: spinner-border .75s linear infinite;
    margin-right: 0.5rem;
  }

  @keyframes spinner-border {
    to { transform: rotate(360deg); }
  }

  .btn-loading .spinner-border {
    opacity: 0.8;
  }

  .btn.loading {
    background-image: none !important;
    opacity: 0.8;
    cursor: wait;
  }

  /* Enhanced animations */
  .input, .btn, #card, #names label {
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .input:focus {
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg), var(--ring);
  }

  #card {
    animation: slideDown 0.4s ease-out;
  }

  @keyframes slideDown {
    from {
      opacity: 0;
      transform: translateY(-20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  #names label {
    animation: fadeIn 0.3s ease-out backwards;
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Theme colors */
  :root {
    --primary: #3b82f6;
    --accent: #0ea5e9;
    --danger: #ef4444;
    --success: #10b981;
    --warning: #f59e0b;
    --info: #6366f1;
  }

  [data-theme="dark"] {
    --primary: #60a5fa;
    --accent: #38bdf8;
    --danger: #f87171;
    --success: #34d399;
    --warning: #fbbf24;
    --info: #818cf8;
  }

  /* Enhanced button states */
  .btn {
    position: relative;
    overflow: hidden;
  }

  .btn::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    background: rgba(255, 255, 255, 0.2);
    border-radius: 50%;
    transform: translate(-50%, -50%);
    transition: width 0.6s ease-out, height 0.6s ease-out;
  }

  .btn:active::after {
    width: 150%;
    height: 150%;
    opacity: 0;
  }
  
  .label-text{ 
    display:inline-block;
    font-size: 14px;
    letter-spacing: 0.01em;
  }
  
  .badge-anim{ 
    transform:scale(1); 
    transition: all .2s ease; 
    width:16px; 
    height:16px; 
    border-radius:4px; 
    background:var(--card);
    border:2px solid rgba(148,163,184,0.3);
    position: relative;
  }
  
  input:checked ~ .badge-anim {
    background: var(--primary);
    border-color: transparent;
  }
  
  input:checked ~ .badge-anim:after {
    content: '';
    position: absolute;
    left: 5px;
    top: 2px;
    width: 4px;
    height: 8px;
    border: solid white;
    border-width: 0 2px 2px 0;
    transform: rotate(45deg);
  }

  /* smooth content change for #noiDung */
  .content-fade { transition: opacity .18s ease; }

  /* Tutorial popup */
  .tutorial-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(15,23,42,0.6);
    backdrop-filter: blur(4px);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s ease;
  }

  .tutorial-overlay.show {
    opacity: 1;
    visibility: visible;
  }

  .tutorial-popup {
    background: var(--card);
    border-radius: 20px;
    padding: 32px;
    width: 90%;
    max-width: 500px;
    box-shadow: var(--shadow-lg);
    transform: translateY(20px);
    transition: all 0.3s ease;
    border: 2px solid rgba(148,163,184,0.1);
  }

  .tutorial-overlay.show .tutorial-popup {
    transform: translateY(0);
  }

  .tutorial-title {
    font-size: 20px;
    font-weight: 600;
    color: var(--text);
    margin-bottom: 24px;
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .tutorial-title .icon {
    color: var(--accent);
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(14,165,233,0.1);
    border-radius: 8px;
  }

  .tutorial-steps {
    display: flex;
    flex-direction: column;
    gap: 20px;
    margin-bottom: 24px;
  }

  .tutorial-step {
    display: flex;
    gap: 16px;
    align-items: flex-start;
    padding: 16px;
    border-radius: 12px;
    background: rgba(148,163,184,0.06);
    transition: all 0.2s ease;
  }

  .tutorial-step:hover {
    background: rgba(148,163,184,0.1);
    transform: translateX(4px);
  }

  .step-number {
    background: var(--primary);
    color: white;
    width: 24px;
    height: 24px;
    border-radius: 999px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    font-size: 14px;
    flex-shrink: 0;
  }

  .step-content {
    color: var(--text);
    font-size: 15px;
    line-height: 1.5;
  }

  .tutorial-close {
    width: 100%;
    padding: 12px;
    border-radius: 12px;
    background: var(--primary);
    color: white;
    border: none;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .tutorial-close:hover {
    background: var(--accent);
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
  }

  .show-tutorial {
    position: fixed;
    bottom: 24px;
    right: 24px;
    background: var(--primary);
    color: white;
    border: none;
    padding: 12px 20px;
    border-radius: 999px;
    font-weight: 600;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
    box-shadow: var(--shadow-lg);
    transition: all 0.2s ease;
  }

  .show-tutorial:hover {
    transform: translateY(-2px);
    background: var(--accent);
  }

  @media (max-width: 640px) {
    .tutorial-popup {
      padding: 24px;
      width: 95%;
    }
    .tutorial-step {
      padding: 12px;
    }
    .show-tutorial {
      bottom: 16px;
      right: 16px;
      padding: 10px 16px;
    }
  }

  /* Footer styles */
  .footer {
    margin-top: auto;
    padding-top: 24px;
    border-top: 2px solid rgba(148,163,184,0.1);
    color: var(--muted);
    width: 100%;
  }

  .security-notice {
    background: rgba(148,163,184,0.06);
    border-radius: 12px;
    padding: 16px 20px;
    color: var(--text);
    font-size: 14px;
    line-height: 1.6;
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 16px;
  }

  .security-notice .icon {
    color: var(--primary);
    flex-shrink: 0;
  }

  .copyright {
    text-align: center;
    font-size: 13px;
    color: var(--muted);
    padding: 12px 0;
  }

  @media (max-width: 640px) {
    .footer {
      margin-top: 32px;
      padding-top: 20px;
    }
    .security-notice {
      font-size: 13px;
      padding: 12px 16px;
    }
  }
</style>
</head>
<body>
  <div class="container">
    <div style="display:flex; align-items:center; justify-content:space-between; gap:12px;">
      <a href="index.html" class="btn btn-ghost" style="display:flex; align-items:center; gap:6px;">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M19 12H5M5 12L12 19M5 12L12 5"/>
        </svg>
        Trang ch·ªß
      </a>
      <h1 style="flex:1; text-align:center; margin:0">TRA C·ª®U PH√ÇN C√îNG C√îNG VI·ªÜC</h1>
      <div>
        <label class="switch" title="Chuy·ªÉn giao di·ªán s√°ng/t·ªëi">
          <input id="themeToggle" type="checkbox" aria-label="Chuy·ªÉn giao di·ªán s√°ng t·ªëi">
          <span class="slider"></span>
        </label>
      </div>
    </div>

  <div style="text-align:center;" class="controls">
    <input id="soVu" class="input" type="text" placeholder="Nh·∫≠p s·ªë v·ª• vi·ªác c·∫ßn tra c·ª©u‚Ä¶"/>
    <button onclick="traCuu()" class="btn btn-search" id="searchBtn">
      <span class="btn-text">üîç Tra c·ª©u</span>
      <span class="btn-loading" style="display:none">
        <span class="spinner-border"></span>
        ƒêang t√¨m...
      </span>
    </button>
  </div>

  <div id="card">
    <div><b>S·ªë v·ª•:</b> <span id="showSoVu">‚Äì</span></div>
    <div style="margin-top:6px;"><b>Ph√¢n c√¥ng c√¥ng vi·ªác c·ª• th·ªÉ:</b>
      <div id="noiDung">‚Äì</div>
    </div>
    <div style="margin-top:12px;"><b>Ch·ªçn t√™n c√°n b·ªô ƒë√£ ho√†n th√†nh c√¥ng vi·ªác:</b></div>
    <div id="names"></div>
    <div id="note"></div>
    <div style="margin-top:12px; display:flex; gap:8px; justify-content:center;">
      <button onclick="boiDo()" class="btn btn-primary">üü• Ho√†n th√†nh</button>
      <button onclick="boBoido()" class="btn btn-ghost">üßπ X√≥a</button>
    </div>
  </div>

  <div id="log"></div>
  
  <!-- Tutorial Button -->
  <button class="show-tutorial" id="showTutorial">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z" stroke="currentColor" stroke-width="2"/>
      <path d="M12 16V12M12 8H12.01" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
    </svg>
    H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng
  </button>

  <!-- Tutorial Overlay -->
  <div class="tutorial-overlay" id="tutorialOverlay">
    <div class="tutorial-popup">
      <div class="tutorial-title">
        <span class="icon">üìù</span>
        H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng
      </div>
      <div class="tutorial-steps">
        <div class="tutorial-step">
          <div class="step-number">1</div>
          <div class="step-content">
            Nh·∫≠p s·ªë v·ª• vi·ªác c·∫ßn tra c·ª©u v√† nh·∫•p v√†o n√∫t "Tra c·ª©u"
          </div>
        </div>
        <div class="tutorial-step">
          <div class="step-number">2</div>
          <div class="step-content">
            ƒê·ª£i t·∫£i danh s√°ch t√™n c√°n b·ªô v√† hi·ªÉn th·ªã c√°c n√∫t ch·ªçn t√™n c√°n b·ªô
          </div>
        </div>
        <div class="tutorial-step">
          <div class="step-number">3</div>
          <div class="step-content">
            Ch·ªçn t√™n c√°n b·ªô ƒë√£ ho√†n th√†nh c√¥ng vi·ªác v√† nh·∫•n n√∫t "Ho√†n th√†nh"
          </div>
        </div>
      </div>
      <button class="tutorial-close" id="closeTutorial">ƒê√£ hi·ªÉu</button>
    </div>
  </div>

  <!-- Instruction for users -->
  <div id="instruction" class="instruction" role="status" aria-live="polite">
    <span class="icon" aria-hidden="true">
      <!-- SVG check icon (uses currentColor) -->
      <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">
        <path d="M9.29 16.29a1 1 0 0 1-1.42 0l-3.3-3.3a1 1 0 1 1 1.42-1.42l2.59 2.59 6.59-6.59a1 1 0 0 1 1.42 1.42l-7.9 7.9z"/>
      </svg>
    </span>
    <span class="text">Xong c√¥ng vi·ªác c·ªßa m√¨nh trong v·ª• vi·ªác th√¨ c√°c ƒë·ªìng ch√≠ nh·∫•p v√†o t√™n c·ªßa m√¨nh v√† nh·∫•n ho√†n th√†nh nh√©!</span>
    <button class="instruction-close" id="instructionClose" aria-label="ƒê√≥ng h∆∞·ªõng d·∫´n">‚úï</button>
  </div>

    <!-- Footer -->
    <footer class="footer">
      <div class="security-notice">
        <span class="icon">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 2L3 7v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V7l-9-5zm0 11V7" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </span>
        <div>
          <strong>L∆∞u √Ω b·∫£o m·∫≠t:</strong> H·ªá th·ªëng n√†y ch·ªâ d√†nh cho c√°n b·ªô ƒë∆∞·ª£c ph√¢n quy·ªÅn. Vui l√≤ng b·∫£o m·∫≠t th√¥ng tin v√† kh√¥ng chia s·∫ª li√™n k·∫øt v·ªõi ng∆∞·ªùi kh√¥ng c√≥ th·∫©m quy·ªÅn.
        </div>
      </div>
      <div class="copyright">
        L∆∞u h√†nh n·ªôi b·ªô - ƒë∆∞·ª£c qu·∫£n l√Ω b·ªüi Nguy·ªÖn ƒê·ª©c Nghƒ©a - ƒê·ªôi tr∆∞·ªüng ƒê·ªôi KNHT - PC09 Kh√°nh H√≤a
      </div>
    </footer>
  </div> <!-- .container -->

<script>
/** üîó Thay b·∫±ng URL /exec m·ªõi nh·∫•t c·ªßa b·∫°n */
const URL = "https://script.google.com/macros/s/AKfycby7DWH4nsVrvYyGlQ0AV_jD5CRDBbEkC4Cwkcv-HQlEqY2kMrqcAMFESuwxeedMb3F1/exec";

/** Danh s√°ch t√™n chu·∫©n ƒë·ªÉ d√≤ trong n·ªôi dung */
const CANBO = ["Nghƒ©a","Th·ªßy","ƒê·∫°t","Tr∆∞·ªùng","Th·ªëng","K·ª≥ Anh","Thao","Ti·∫øn","Huy","Nam","PNam","T√¨nh","Qu√¢n","L∆∞·ª£ng","Ph√∫c","Khang","D≈©ng","Nh·∫≠t","S√°ng","Khoa","B√¨nh","Tu·∫•n","H·∫£i","Tu√¢n","Trung","Duy"];

/** ‚îÄ‚îÄ Helpers robust cho JSON ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
async function getJSON(url) {
  const r = await fetch(url);
  const j = await r.json();
  // n·∫øu backend tr·∫£ d·∫°ng [ {...} ]
  if (Array.isArray(j)) return j[0] || {};
  return j;
}
async function postJSON(url, payload) {
  const r = await fetch(url, { method: "POST", body: JSON.stringify(payload) });
  const j = await r.json();
  return Array.isArray(j) ? (j[0] || {}) : j;
}
/** Tr√≠ch m·∫£ng t·ª´ {data:[‚Ä¶]} ho·∫∑c tr·∫£ [] */
function pickArray(resp) {
  if (Array.isArray(resp)) return resp;
  if (resp && Array.isArray(resp.data)) return resp.data;
  return [];
}

/** ‚îÄ‚îÄ State ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
let currentSoVu = "";
let lastRawText = "";
let currentUser = "";

// Ki·ªÉm tra ƒëƒÉng nh·∫≠p
(function checkLogin() {
  const user = localStorage.getItem('pc09_user');
  if (!user) {
    window.location.href = 'login.html';
    return;
  }
  currentUser = user;
  
  // Kh√¥ng hi·ªÉn th·ªã user info ·ªü trang tra c·ª©u
})();

function logout() {
  if (confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën ƒëƒÉng xu·∫•t?')) {
    localStorage.removeItem('pc09_user');
    window.location.href = 'login.html';
  }
}

/** ‚îÄ‚îÄ Render checkbox ch·ªâ t√™n c√≥ trong raw ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
function renderCheckboxes(foundNames, coloredNames) {
  const wrap = document.getElementById("names");
  const note = document.getElementById("note");
  wrap.innerHTML = "";
  note.textContent = "";

  if (!foundNames.length) {
    note.textContent = "‚ö†Ô∏è Kh√¥ng t√¨m th·∫•y t√™n c√°n b·ªô n√†o trong n·ªôi dung.";
    return;
  }

  foundNames.forEach((name, idx) => {
    const checked = coloredNames.includes(name);
    const id = `cb_${idx}_${name.replace(/\s+/g,'_')}`;
    const label = document.createElement("label");
    if (checked) label.classList.add("red");
    // Accessible checkbox + visual badge span for animation
    label.innerHTML = `<input id="${id}" class="sr-only" type="checkbox" name="cb" value="${escapeHTML(name)}" ${checked ? "checked":""} aria-label="B√¥i ƒë·ªè ${escapeHTML(name)}"> <span class="badge-anim cb">` +
                      `</span><span class="label-text">${escapeHTML(name)}</span>`;
    // reflect checked state visually
    if (checked) {
      const badge = label.querySelector('.badge-anim');
      if (badge) badge.style.transform = 'scale(1.08)';
    }
    // attach change listener to animate
    label.querySelector('input[name="cb"]').addEventListener('change', (e) => {
      const badge = label.querySelector('.badge-anim');
      if (badge) {
        badge.style.transform = e.target.checked ? 'scale(1.08)' : 'scale(1)';
      }
      // toggle red class for visual
      label.classList.toggle('red', e.target.checked);
    });
    wrap.appendChild(label);
  });
  // animate labels appearance
  animateLabelsIn();
}

/** ‚îÄ‚îÄ Tra c·ª©u ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
async function traCuu() {
  const soVu = document.getElementById("soVu").value.trim();
  if (!soVu) return alert("Nh·∫≠p s·ªë v·ª•!");
  
  // Show loading state
  const searchBtn = document.getElementById("searchBtn");
  const btnText = searchBtn.querySelector('.btn-text');
  const btnLoading = searchBtn.querySelector('.btn-loading');
  searchBtn.disabled = true;
  searchBtn.classList.add('loading');
  btnText.style.display = 'none';
  btnLoading.style.display = 'inline-flex';
  
  currentSoVu = soVu;
  document.getElementById("showSoVu").textContent = soVu;
  document.getElementById("noiDung").textContent = "ƒêang t·∫£i‚Ä¶";
  // X√≥a c√°c n·ªôi dung c≈©
  document.getElementById("names").innerHTML = "";
  document.querySelector('#names').previousElementSibling.style.display = 'none';
  document.getElementById("note").textContent = "";
  document.getElementById("log").textContent = "";

  try {
    // 1) L·∫•y text g·ªëc ƒë·ªÉ L·ªåC t√™n
    const info = await getJSON(`${URL}?action=getPhanCongBySoVu&soVu=${encodeURIComponent(soVu)}`);
    if (!info || info.found === false) {
      document.getElementById("noiDung").textContent = "(Kh√¥ng t√¨m th·∫•y d·ªØ li·ªáu)";
      return;
    }
    lastRawText = (info.raw || "").toString();

    // 2) L·∫•y HTML RichText c√≥ m√†u th·∫≠t
    const rich = await getJSON(`${URL}?action=getRichHTML&soVu=${encodeURIComponent(soVu)}`);
    // smooth update
    const nd = document.getElementById("noiDung");
    if (nd) {
      nd.classList.add('content-fade');
      nd.style.opacity = '0.4';
      setTimeout(() => { nd.innerHTML = rich && rich.html ? rich.html : "(Kh√¥ng c√≥ d·ªØ li·ªáu)"; nd.style.opacity = '1'; }, 90);
    }

    // 3) L·∫•y danh s√°ch ƒë√£ b√¥i ƒë·ªè
    const coloredResp = await getJSON(`${URL}?action=getColored&soVu=${encodeURIComponent(soVu)}`);
    const coloredArr = pickArray(coloredResp);

    // 4) L·ªçc danh s√°ch t√™n ch·ªâ nh·ªØng t√™n c√≥ xu·∫•t hi·ªán trong raw
    const rawLower = lastRawText.toLowerCase();
    const foundNames = CANBO.filter(n => rawLower.includes(n.toLowerCase()));

    // 5) Render checkbox
    renderCheckboxes(foundNames, coloredArr);
    // Hi·ªán ti√™u ƒë·ªÅ ph·∫ßn ch·ªçn t√™n c√°n b·ªô n·∫øu c√≥ d·ªØ li·ªáu
    document.querySelector('#names').previousElementSibling.style.display = foundNames.length ? 'block' : 'none';

    document.getElementById("log").textContent = "ƒê√£ t·∫£i xong.";
  } catch (e) {
    document.getElementById("noiDung").textContent = "(L·ªói khi t·∫£i d·ªØ li·ªáu)";
    document.getElementById("log").textContent = "L·ªói: " + e.message;
  } finally {
    // Reset loading state
    const searchBtn = document.getElementById("searchBtn");
    const btnText = searchBtn.querySelector('.btn-text');
    const btnLoading = searchBtn.querySelector('.btn-loading');
    searchBtn.disabled = false;
    searchBtn.classList.remove('loading');
    btnText.style.display = 'inline';
    btnLoading.style.display = 'none';
  }
}

/** ‚îÄ‚îÄ G·ª≠i b√¥i ƒë·ªè / b·ªè b√¥i ƒë·ªè ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
async function boiDo() {
  if (!currentSoVu) return alert("H√£y tra c·ª©u s·ªë v·ª• vi·ªác tr∆∞·ªõc!");
  const selected = [...document.querySelectorAll("input[name='cb']:checked")].map(x => x.value);
  if (!selected.length) return alert("Ch∆∞a ch·ªçn t√™n c√°n b·ªô!");
  // show spinner and disable buttons immediately
  showLoading('ƒêang x·ª≠ l√Ω d·ªØ li·ªáu...');
  disableButtons(true);
  // update local view immediately for snappy UX
  applyClientSideHighlights(selected);
  try {
    // Fetch current colored list from server and merge (union) with our selected names
    const coloredResp = await getJSON(`${URL}?action=getColored&soVu=${encodeURIComponent(currentSoVu)}`);
    const serverColored = pickArray(coloredResp);
    // Build union preserving unique names
    const unionSet = new Set([...(serverColored || []), ...selected]);
    const unionArr = Array.from(unionSet);

    const res = await postJSON(URL, { 
      action: "applyHighlight", 
      soVu: currentSoVu, 
      selectedNames: unionArr, 
      user: currentUser 
    });
    // show server message (if any) after response
    document.getElementById("log").textContent = res.message || "ƒê√£ ho√†n th√†nh.";
    await refreshRichAndCheckboxes(); // ‚¨ÖÔ∏è ch·ªâ refresh ph·∫ßn m√†u & tick
  } catch (e) {
    document.getElementById("log").textContent = "L·ªói: " + e.message;
  } finally {
    disableButtons(false);
    hideLoading();
  }
}

async function boBoido() {
  if (!currentSoVu) return alert("H√£y tra c·ª©u s·ªë v·ª• vi·ªác tr∆∞·ªõc!");
  // show spinner and disable buttons immediately
  showLoading('ƒêang xo√° b√¥i ƒë·ªè...');
  disableButtons(true);
  // remove local highlights immediately
  removeClientSideHighlights();
  try {
    const res = await postJSON(URL, { 
      action: "clearHighlight", 
      soVu: currentSoVu, 
      user: currentUser 
    });
    document.getElementById("log").textContent = res.message || "ƒê√£ b·ªè b√¥i ƒë·ªè.";
    await refreshRichAndCheckboxes(); // ‚¨ÖÔ∏è ch·ªâ refresh ph·∫ßn m√†u & tick
  } catch (e) {
    document.getElementById("log").textContent = "L·ªói b·ªè b√¥i ƒë·ªè: " + e.message;
  } finally {
    disableButtons(false);
    hideLoading();
  }
}

/** ‚îÄ‚îÄ Client-side instant highlighting helpers ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
function escapeHTML(str) {
  return str.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;").replace(/'/g, "&#39;");
}

function escapeRegExp(s) {
  return s.replace(/[.*+?^${}()|[\\]\\\\]/g, "\\$&");
}

// Replace plain text occurrences of names inside #noiDung with highlighted spans.
function applyClientSideHighlights(names) {
  const node = document.getElementById('noiDung');
  if (!node) return;
  // prefer working with innerText/raw text to avoid breaking existing HTML structure too much
  // but if the content is already HTML (rich), we operate on innerHTML cautiously.
  const html = node.innerHTML || '';

  // build a single regex that matches any name as a whole word (case-insensitive)
  const patterns = names.map(n => escapeRegExp(n));
  if (!patterns.length) return;
  const re = new RegExp('(' + patterns.join('|') + ')', 'gi');

  // Replace matches with span.highlight while preserving original casing
  const newHtml = html.replace(re, match => `<span class="highlight">${escapeHTML(match)}</span>`);
  // gently swap
  node.classList.add('content-fade');
  node.style.opacity = '0.6';
  setTimeout(() => { node.innerHTML = newHtml; node.style.opacity = '1'; }, 80);
}

function removeClientSideHighlights() {
  const node = document.getElementById('noiDung');
  if (!node) return;
  // remove highlight spans by unwrapping them
  const html = node.innerHTML || '';
  const cleaned = html.replace(/<span\s+class="highlight">([\s\S]*?)<\/span>/gi, '$1');
  node.classList.add('content-fade');
  node.style.opacity = '0.6';
  setTimeout(() => { node.innerHTML = cleaned; node.style.opacity = '1'; }, 80);
}

// Loading UI helpers (spinner + message in #log)
function showLoading(message) {
  const log = document.getElementById('log');
  if (!log) return;
  log.innerHTML = `<span class="spinner" aria-hidden="true"></span>${message || 'ƒêang x·ª≠ l√Ω...'} `;
}

function hideLoading() {
  const log = document.getElementById('log');
  if (!log) return;
  // Remove any spinner HTML while keeping the textual message (if any).
  // Using textContent strips any <span class="spinner"> so spinner stops.
  if (log) log.innerHTML = (log.textContent || '').trim();
}

function disableButtons(disable) {
  document.querySelectorAll('button').forEach(b => b.disabled = !!disable);
}

// üîÑ Ch·ªâ l√†m m·ªõi ph·∫ßn "N·ªôi dung (m√†u th·∫≠t)" + tr·∫°ng th√°i tick/m√†u
async function refreshRichAndCheckboxes() {
  if (!currentSoVu) return;

  // C·∫≠p nh·∫≠t l·∫°i HTML RichText c√≥ m√†u
  const rich = await getJSON(`${URL}?action=getRichHTML&soVu=${encodeURIComponent(currentSoVu)}`);
  const nd = document.getElementById("noiDung");
  if (nd) {
    nd.classList.add('content-fade'); nd.style.opacity = '0.4';
    setTimeout(() => { nd.innerHTML = rich && rich.html ? rich.html : "(Kh√¥ng c√≥ d·ªØ li·ªáu)"; nd.style.opacity = '1'; }, 90);
  }

  // L·∫•y danh s√°ch ƒë√£ b√¥i ƒë·ªè ƒë·ªÉ c·∫≠p nh·∫≠t tick & class 'red'
  const coloredResp = await getJSON(`${URL}?action=getColored&soVu=${encodeURIComponent(currentSoVu)}`);
  const coloredArr = pickArray(coloredResp);

  // C·∫≠p nh·∫≠t l·∫°i checkbox & nh√£n ƒë√£ hi·ªÉn th·ªã s·∫µn
  document.querySelectorAll("#names input[name='cb']").forEach(cb => {
    const isChecked = coloredArr.includes(cb.value);
    cb.checked = isChecked;
    if (cb.parentElement) {
      cb.parentElement.classList.toggle("red", isChecked);
    }
  });
}

// Enter key on input#soVu triggers traCuu()
document.addEventListener('keydown', function (e) {
  const el = document.getElementById('soVu');
  if (!el) return;
  if (document.activeElement === el && e.key === 'Enter') {
    e.preventDefault();
    traCuu();
  }
});

// Instruction close behavior with persistence
;(function(){
  const key = 'pc09_instruction_closed_v1';
  const instr = document.getElementById('instruction');
  const btn = document.getElementById('instructionClose');
  if (!instr) return;
  // restore state
  try {
    // Force instruction visible by clearing stored closed flag
    localStorage.removeItem(key);
  } catch (e) {}

  if (btn) {
    btn.addEventListener('click', () => {
      instr.classList.add('closing');
      // after transition, hide and persist
      setTimeout(() => {
        instr.style.display = 'none';
        try { localStorage.setItem(key, '1'); } catch (e) {}
      }, 180);
    });
  }
})();

// Theme toggle (persist in localStorage)
(function(){
  const key = 'pc09_theme_v1';
  const checkbox = document.getElementById('themeToggle');
  function applyTheme(t){
    if (t === 'dark') document.documentElement.setAttribute('data-theme','dark');
    else document.documentElement.removeAttribute('data-theme');
    if (checkbox) checkbox.checked = (t === 'dark');
  }
  try{
    const stored = localStorage.getItem(key);
    applyTheme(stored === 'dark' ? 'dark' : 'light');
  }catch(e){}
  if (checkbox) checkbox.addEventListener('change', ()=>{
    const isDark = checkbox.checked;
    const next = isDark ? 'dark' : 'light';
    applyTheme(next);
    try{ localStorage.setItem(key, next); }catch(e){}
  });
})();

// Small animation when labels are inserted (fade/slide in)
function animateLabelsIn() {
    const labels = document.querySelectorAll('#names label');
    labels.forEach((l, i) => {
      l.style.opacity = '0'; l.style.transform = 'translateY(6px)';
      setTimeout(()=>{ l.style.transition = 'opacity .18s ease, transform .18s ease'; l.style.opacity='1'; l.style.transform='none'; }, 40*i);
    });
  }

  // Tutorial popup handling
  ;(function(){
    const overlay = document.getElementById('tutorialOverlay');
    const showBtn = document.getElementById('showTutorial');
    const closeBtn = document.getElementById('closeTutorial');
    const storageKey = 'pc09_tutorial_seen';

    function showTutorial() {
      overlay.classList.add('show');
      document.body.style.overflow = 'hidden';
    }

    function hideTutorial() {
      overlay.classList.remove('show');
      document.body.style.overflow = '';
      try {
        localStorage.setItem(storageKey, '1');
      } catch(e) {}
    }

    if (showBtn) showBtn.addEventListener('click', showTutorial);
    if (closeBtn) closeBtn.addEventListener('click', hideTutorial);
    if (overlay) overlay.addEventListener('click', (e) => {
      if (e.target === overlay) hideTutorial();
    });

    // Show tutorial automatically on first visit
    try {
      if (!localStorage.getItem(storageKey)) {
        showTutorial();
      }
    } catch(e) {}
  })();</script>
</body>
</html>